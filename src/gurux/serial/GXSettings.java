//
// --------------------------------------------------------------------------
//  Gurux Ltd
// 
//
//
// Filename:        $HeadURL$
//
// Version:         $Revision$,
//                  $Date$
//                  $Author$
//
// Copyright (c) Gurux Ltd
//
//---------------------------------------------------------------------------
//
//  DESCRIPTION
//
// This file is a part of Gurux Device Framework.
//
// Gurux Device Framework is Open Source software; you can redistribute it
// and/or modify it under the terms of the GNU General Public License 
// as published by the Free Software Foundation; version 2 of the License.
// Gurux Device Framework is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of 
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. 
// See the GNU General Public License for more details.
//
// This code is licensed under the GNU General Public License v2. 
// Full text may be retrieved at http://www.gnu.org/licenses/gpl-2.0.txt
//---------------------------------------------------------------------------

package gurux.serial;

import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.awt.event.KeyEvent;
import javax.swing.DefaultComboBoxModel;
import javax.swing.JComponent;
import javax.swing.JOptionPane;
import javax.swing.JRootPane;
import javax.swing.KeyStroke;

/**
 * SMS settings dialog.
 */
class GXSettings extends javax.swing.JDialog implements ActionListener {
    boolean Accepted;
    GXSerial Target;
    /**
     * Creates new form GXSettings
     */
    @SuppressWarnings("unchecked")
    public GXSettings(java.awt.Frame parent, boolean modal, GXSerial comp) {
        super(parent, modal);        
        super.setLocationRelativeTo(parent); 
        initComponents();                 
        Target = comp;
        String[] ports = GXSerial.getPortNames();
        PortCB.setModel(new DefaultComboBoxModel(ports));
        int[] rates = GXSerial.getAvailableBaudRates(null);
        BaudRate.setModel(new DefaultComboBoxModel(getStrings(rates)));
        int[] dataBits = new int[]{7, 8};
        DataBits.setModel(new DefaultComboBoxModel(getStrings(dataBits)));        
        String[] parity = new String[]{"None", "Odd", "Even", "Mark", "Space"};
        Parity.setModel(new DefaultComboBoxModel(parity));               
        String[] stopBits = new String[]{"One", "One_Point_Five", "Two"};
        StopBits.setModel(new DefaultComboBoxModel<String>(stopBits));                 
        this.PortCB.setSelectedItem(Target.m_PortName);
        this.BaudRate.setSelectedItem(String.valueOf(Target.m_BaudRate));
        this.DataBits.setSelectedItem(String.valueOf(Target.m_DataBits));        
        this.Parity.setSelectedItem(findParity(Target.m_Parity));        
        this.StopBits.setSelectedItem(findStopBit(Target.m_StopBits));        
    }
            
    /*
     * If user press ESC.
     */
    @Override
    public void actionPerformed(ActionEvent e) {        
        this.dispose();
    }
    
    final String findStopBit(gurux.io.StopBits stopBits)
    {
        switch(stopBits)
        {
            case ONE:
                return "One";
            case TWO:
                return "Two";
            case ONE_POINT_FIVE:
                return "One_Point_Five";
        }
        return "";
    }
    final String findParity(gurux.io.Parity parity)
    {
        switch(parity)
        {
            case NONE:
                return "None";
            case ODD:
                return "Odd";
            case EVEN:
                return "Even";
            case MARK:
                return "Mark";
            case SPACE:
                return "Space";
        }
        return "";
    }
    
    final String[] getStrings(int[] list)
    {
        String[] tmp = new String[list.length];
        int pos = 0;
        for(int it : list)
        {
            tmp[pos] = String.valueOf(it);
            ++pos;
        }
        return tmp;
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jPanel1 = new javax.swing.JPanel();
        PortPanel = new javax.swing.JPanel();
        PortLbl1 = new javax.swing.JLabel();
        PortCB = new javax.swing.JComboBox();
        BaudRatePanel = new javax.swing.JPanel();
        BaudRateLbl = new javax.swing.JLabel();
        BaudRate = new javax.swing.JComboBox();
        DataBitsPanel = new javax.swing.JPanel();
        DataBitsLbl = new javax.swing.JLabel();
        DataBits = new javax.swing.JComboBox();
        ParityPanel = new javax.swing.JPanel();
        ParityLbl = new javax.swing.JLabel();
        Parity = new javax.swing.JComboBox();
        StopBitsPanel = new javax.swing.JPanel();
        StopBitsLbl = new javax.swing.JLabel();
        StopBits = new javax.swing.JComboBox();
        OKBtn = new javax.swing.JButton();
        CancelBtn = new javax.swing.JButton();

        setDefaultCloseOperation(javax.swing.WindowConstants.DISPOSE_ON_CLOSE);

        PortPanel.setPreferredSize(new java.awt.Dimension(298, 35));

        PortLbl1.setText("Port:");

        PortCB.setModel(new javax.swing.DefaultComboBoxModel(new String[] { "Item 1", "Item 2", "Item 3", "Item 4" }));

        javax.swing.GroupLayout PortPanelLayout = new javax.swing.GroupLayout(PortPanel);
        PortPanel.setLayout(PortPanelLayout);
        PortPanelLayout.setHorizontalGroup(
            PortPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(PortPanelLayout.createSequentialGroup()
                .addContainerGap()
                .addComponent(PortLbl1)
                .addGap(70, 70, 70)
                .addComponent(PortCB, 0, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addContainerGap())
        );
        PortPanelLayout.setVerticalGroup(
            PortPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, PortPanelLayout.createSequentialGroup()
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addGroup(PortPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(PortLbl1)
                    .addComponent(PortCB, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addContainerGap())
        );

        BaudRatePanel.setPreferredSize(new java.awt.Dimension(218, 35));

        BaudRateLbl.setText("Baud Rate:");

        BaudRate.setModel(new javax.swing.DefaultComboBoxModel(new String[] { "Item 1", "Item 2", "Item 3", "Item 4" }));

        javax.swing.GroupLayout BaudRatePanelLayout = new javax.swing.GroupLayout(BaudRatePanel);
        BaudRatePanel.setLayout(BaudRatePanelLayout);
        BaudRatePanelLayout.setHorizontalGroup(
            BaudRatePanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(BaudRatePanelLayout.createSequentialGroup()
                .addContainerGap()
                .addComponent(BaudRateLbl)
                .addGap(41, 41, 41)
                .addComponent(BaudRate, 0, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addContainerGap())
        );
        BaudRatePanelLayout.setVerticalGroup(
            BaudRatePanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, BaudRatePanelLayout.createSequentialGroup()
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addGroup(BaudRatePanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(BaudRateLbl)
                    .addComponent(BaudRate, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addContainerGap())
        );

        DataBitsPanel.setPreferredSize(new java.awt.Dimension(220, 35));

        DataBitsLbl.setText("Data Bits:");

        DataBits.setModel(new javax.swing.DefaultComboBoxModel(new String[] { "Item 1", "Item 2", "Item 3", "Item 4" }));

        javax.swing.GroupLayout DataBitsPanelLayout = new javax.swing.GroupLayout(DataBitsPanel);
        DataBitsPanel.setLayout(DataBitsPanelLayout);
        DataBitsPanelLayout.setHorizontalGroup(
            DataBitsPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(DataBitsPanelLayout.createSequentialGroup()
                .addContainerGap()
                .addComponent(DataBitsLbl)
                .addGap(50, 50, 50)
                .addComponent(DataBits, 0, 181, Short.MAX_VALUE)
                .addContainerGap())
        );
        DataBitsPanelLayout.setVerticalGroup(
            DataBitsPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, DataBitsPanelLayout.createSequentialGroup()
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addGroup(DataBitsPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(DataBits, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(DataBitsLbl))
                .addGap(14, 14, 14))
        );

        ParityPanel.setPreferredSize(new java.awt.Dimension(219, 35));

        ParityLbl.setText("Parity:");

        Parity.setModel(new javax.swing.DefaultComboBoxModel(new String[] { "Item 1", "Item 2", "Item 3", "Item 4" }));

        javax.swing.GroupLayout ParityPanelLayout = new javax.swing.GroupLayout(ParityPanel);
        ParityPanel.setLayout(ParityPanelLayout);
        ParityPanelLayout.setHorizontalGroup(
            ParityPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(ParityPanelLayout.createSequentialGroup()
                .addContainerGap()
                .addComponent(ParityLbl)
                .addGap(64, 64, 64)
                .addComponent(Parity, 0, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addContainerGap())
        );
        ParityPanelLayout.setVerticalGroup(
            ParityPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, ParityPanelLayout.createSequentialGroup()
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addGroup(ParityPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(ParityLbl)
                    .addComponent(Parity, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(17, 17, 17))
        );

        StopBitsLbl.setText("Stop Bits:");

        StopBits.setModel(new javax.swing.DefaultComboBoxModel(new String[] { "Item 1", "Item 2", "Item 3", "Item 4" }));

        javax.swing.GroupLayout StopBitsPanelLayout = new javax.swing.GroupLayout(StopBitsPanel);
        StopBitsPanel.setLayout(StopBitsPanelLayout);
        StopBitsPanelLayout.setHorizontalGroup(
            StopBitsPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(StopBitsPanelLayout.createSequentialGroup()
                .addContainerGap()
                .addComponent(StopBitsLbl)
                .addGap(49, 49, 49)
                .addComponent(StopBits, 0, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addContainerGap())
        );
        StopBitsPanelLayout.setVerticalGroup(
            StopBitsPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, StopBitsPanelLayout.createSequentialGroup()
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addGroup(StopBitsPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(StopBitsLbl)
                    .addComponent(StopBits, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(17, 17, 17))
        );

        javax.swing.GroupLayout jPanel1Layout = new javax.swing.GroupLayout(jPanel1);
        jPanel1.setLayout(jPanel1Layout);
        jPanel1Layout.setHorizontalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(PortPanel, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
            .addComponent(BaudRatePanel, javax.swing.GroupLayout.DEFAULT_SIZE, 298, Short.MAX_VALUE)
            .addComponent(DataBitsPanel, javax.swing.GroupLayout.DEFAULT_SIZE, 298, Short.MAX_VALUE)
            .addComponent(ParityPanel, javax.swing.GroupLayout.DEFAULT_SIZE, 298, Short.MAX_VALUE)
            .addComponent(StopBitsPanel, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
        );
        jPanel1Layout.setVerticalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addComponent(PortPanel, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(BaudRatePanel, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(DataBitsPanel, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(ParityPanel, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(StopBitsPanel, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
        );

        OKBtn.setText("OK");
        OKBtn.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                OKBtnActionPerformed(evt);
            }
        });

        CancelBtn.setText("Cancel");
        CancelBtn.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                CancelBtnActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addComponent(OKBtn)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(CancelBtn)
                .addContainerGap())
            .addGroup(layout.createSequentialGroup()
                .addComponent(jPanel1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(0, 0, Short.MAX_VALUE))
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addComponent(jPanel1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(CancelBtn)
                    .addComponent(OKBtn))
                .addContainerGap())
        );

        pack();
    }// </editor-fold>//GEN-END:initComponents


    @Override
    protected JRootPane createRootPane() {
        KeyStroke stroke = KeyStroke.getKeyStroke(KeyEvent.VK_ESCAPE, 0);
        JRootPane rootPane = new JRootPane();
        rootPane.registerKeyboardAction(this, stroke, JComponent.WHEN_IN_FOCUSED_WINDOW);
        return rootPane;
    }
    
    /*
     * Accept changes.
     */            
    private void OKBtnActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_OKBtnActionPerformed
        try
        {
            Target.m_PortName = this.PortCB.getSelectedItem().toString();
            Target.m_BaudRate = Integer.parseInt(this.BaudRate.getSelectedItem().toString());
            Target.m_DataBits = Integer.parseInt(this.DataBits.getSelectedItem().toString());        
            Target.m_Parity = gurux.io.Parity.valueOf(this.Parity.getSelectedItem().toString().toUpperCase());        
            Target.m_StopBits = gurux.io.StopBits.valueOf(this.StopBits.getSelectedItem().toString().toUpperCase());        
            Accepted = true;        
            this.dispose();
        }
        catch(Exception ex)
        {
            JOptionPane.showMessageDialog(this, ex.getMessage());
        }
    }//GEN-LAST:event_OKBtnActionPerformed

    /*
     * Discard changes.
     */
    private void CancelBtnActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_CancelBtnActionPerformed
        this.dispose();
    }//GEN-LAST:event_CancelBtnActionPerformed

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JComboBox BaudRate;
    private javax.swing.JLabel BaudRateLbl;
    private javax.swing.JPanel BaudRatePanel;
    private javax.swing.JButton CancelBtn;
    private javax.swing.JComboBox DataBits;
    private javax.swing.JLabel DataBitsLbl;
    private javax.swing.JPanel DataBitsPanel;
    private javax.swing.JButton OKBtn;
    private javax.swing.JComboBox Parity;
    private javax.swing.JLabel ParityLbl;
    private javax.swing.JPanel ParityPanel;
    private javax.swing.JComboBox PortCB;
    private javax.swing.JLabel PortLbl1;
    private javax.swing.JPanel PortPanel;
    private javax.swing.JComboBox StopBits;
    private javax.swing.JLabel StopBitsLbl;
    private javax.swing.JPanel StopBitsPanel;
    private javax.swing.JPanel jPanel1;
    // End of variables declaration//GEN-END:variables
}
